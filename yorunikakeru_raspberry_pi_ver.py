import RPi.GPIO as GPIO
import time
GPIO.setmode(GPIO.BCM)
BUZZER_PIN = 26
BTN = 19
# https://youtu.be/x8VYWazR5mE
#dE 4/4 bpm:130
tone = [
    156,175,196,208,233,262,294,
    311,349,392,415,466,523,587,
    622,698,784,831,932,1047
]
spec = [
    0,247,  #B3 verse   1-3 
    988,    #B5 verse   8-3
    494     #B4 chorus  2-4
]
full = [
    3,5,6,4,3,2,1,              2,6,5,6,3,2,1,              -1,1,2,0,4,3,10,                9,7,1,7,5,6,5,
    3,5,6,4,3,2,7,              6,5,5,6,7,8,3,              3,2,1,3,10,                     9,7,

    -2,-1,1,5,6,5,3,-1,1,2,     3,-1,8,7,5,3,5,6,5,3,       2,-1,3,2,1,-1,100,4,            3,0,2,1,5,4,3,-2,           #100 = B3(247)
    -2,-1,1,5,6,5,3,-1,1,2,     3,-1,8,7,5,3,5,6,5,3,       2,-1,1,5,3,2,1,-1,100,4,        3,0,-2,-1,1,2,3,6,5,2,3,-1,    
    1,6,7,8,7,5,                3,5,6,5,5,6,                8,9,10,6,6,10,9,12,             11,11,10,10,13,12,
    10,9,8,6,8,6,8,9,           8,7,10,7,5,6,               6,7,8,9,10,9,8,                 7,7,6,6,
    5,6,7,8,7,5,                3,5,6,5,5,6,                8,9,10,9,10,12,13,12,           10,9,10,10,13,12,
    10,9,8,6,8,6,8,9,           8,7,9,7,5,6,                6,7,8,9,10,9,8,                 7,7,6,5,5,
    5,6,6,8,8,6,10,10,          9,10,9,5,5,5,6,10,10,10,    12,12,12,10,6,6,8,8,9,10,8,6,   8,6,8,9,10,11,12,10,
    9,8,6,8,10,9,8,             8,9,10,200,10,9,8,          7,5,6,5,6,8,6,                  8,11,10,8,                  #200 = B5(988)

    7,5,5,6,3,2,1,              2,6,5,3,3,2,1,              1,5,4,3,2,1,0,1,                2,4,3,1,6,5,
    3,5,6,4,3,2,1,              2,6,5,6,3,2,1,              -1,0,1,-1,1,2,3,1,              3,6,300,1,1,8,
    7,5,5,6,3,2,1,              2,6,5,3,3,2,1,              1,5,4,3,2,1,0,1,                2,4,3,2,3,6,5,
    3,5,6,4,3,2,7,              6,5,300,6,7,8,3,            2,1,-1,1,4,3,1,                 2,1,6,5,3,-1,1,2,           #300 = B4(494)

    3,-1,8,7,5,3,5,6,5,3,       2,-1,3,2,1,-1,100,4,        3,0,2,1,5,4,3,-2,               -2,-1,1,5,6,5,3,-1,1,2, 
    3,-1,8,7,5,3,5,6,5,3,       2,-1,1,5,3,2,1,-1,100,4,    3,0,-2,-1,1,2,3,6,5,2,3,-1,     1,
]
full_dur = [
    1,1,1.5,1.5,1,1,1,                      1,1,1,0.5,1,1.5,2,                  1,1,1.5,1.5,1,1,1,                                  1,1,1.5,1.5,1,1,1,
    1,1,1.5,1.5,1,1,1,                      1,1,1,1,1,2,1,                      1,1,4,1,1,                                          1,7,

    0.5,0.5,0.5,0.5,0.5,1,1.5,1,1,1,        0.5,0.5,0.5,0.5,0.5,1,1.5,1,1,1,    1,1,0.5,1,1.5,1,1,1,                                1,1,1,0.5,1.5,1,1,1,
    0.5,0.5,0.5,0.5,0.5,1,1.5,1,1,1,        0.5,0.5,0.5,0.5,0.5,1,1.5,1,1,1,    0.5,0.5,0.5,0.5,0.5,1,1.5,1,1,1,                    1,2,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
    2,1,1,1,2,1,                            1,2,2,1,1,1,                        1,1,1,1,1,1,1,1,                                    1,2,2,1,1,1,
    1,1,1,1,1,1,1.5,2,                      1,1,0.5,1.5,1,1.5,                  1,1,1,1,1,2,1,                                      1,2,1,5,
    1,1,1,1,2,1,                            1,2,2,1,1,1,                        1,1,1,1,1,1,1,1,                                    1,2,2,1,1,1,
    1,1,1,1,1,1,1.5,2,                      1,1,0.5,1.5,1,1.5,                  1,1,1,1,1,2,1,                                      1,2,4,0.5,0.5,
    1,1,1.5,1.5,1.5,0.5,0.5,0.5,            1,1,1,0.5,1,0.5,1.5,0.5,0.5,0.5,    0.5,0.5,0.5,1.5,0.5,0.5,0.5,0.5,0.5,1.5,0.5,0.5,    0.5,0.5,0.5,3.5,1,1,0.5,1,    
    0.5,2,1,1,1,1,1,                        1,1,1,1,1,2,1,                      1,1,1,1,1,2,1,                                      1,1,5,1,

    1,1,1.5,1.5,1,1,1,                      1,1,1,0.5,1,1.5,2,                  1,1,1,1,1,1,1,1,                                    1,1,1.5,1.5,1,2,
    1,1,1.5,1.5,1,1,1,                      1,1,1,0.5,1,1.5,2,                  1,1,1,1,1,1,1,1,                                    1,1,3,1,1,1,
    1,1,1.5,1.5,1,1,1,                      1,1,1,0.5,1,1.5,2,                  1,1,1,1,1,1,1,1,                                    1,1,1,0.5,1,1.5,2,
    1,1,1.5,1.5,1,1,1,                      1,1,1,1,1,2,1,                      1,2,1,1,0.5,1.5,1,                                  1,1,0.5,1,1.5,1,1,1,

    0.5,0.5,0.5,0.5,0.5,1,1.5,1,1,1,        1,1,0.5,1,1.5,1,1,1,                1,1,1,0.5,1.5,1,1,1,                                0.5,0.5,0.5,0.5,0.5,1,1.5,1,1,1,
    0.5,0.5,0.5,0.5,0.5,1,1.5,1,1,1,        0.5,0.5,0.5,0.5,0.5,1,1.5,1,1,1,    1,2,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,        2
]
WAIT_TIME = 230
DURATION = 0.2307
GPIO.setup(BUZZER_PIN, GPIO.OUT)
GPIO.setup(BTN,  GPIO.IN, pull_up_down=GPIO.PUD_DOWN)

def buzz(pitch,DURATION=0.5) :
    period = 1.0 / pitch
    half_period = period / 2
    cycles = int(DURATION * pitch)

    for i in range(cycles) :
        GPIO.output(BUZZER_PIN, GPIO.HIGH)
        time.sleep(half_period)
        GPIO.output(BUZZER_PIN, GPIO.LOW)
        time.sleep(half_period)

def mycallback(channel):
    print("pressed")
    for i in range(len(full)):
        if full[i] < 100:
            buzz(tone[full[i]+6],DURATION*full_dur[i])
        else:
            buzz(tone[int(full[i]/100)+6],DURATION*full_dur[i])

try:
    GPIO.add_event_detect(BTN, GPIO.FALLING, callback=mycallback, bouncetime=WAIT_TIME)
    while 1:
        time.sleep(1)

except KeyboardInterrupt:
    print("Exception: KeyboardInterrupt")

finally:
    GPIO.cleanup()

#define NOTE_DS3 156    do  -6  1.
#define NOTE_E3  165
#define NOTE_F3  175    re  -5  2.
#define NOTE_FS3 185
#define NOTE_G3  196    mi  -4  3.
#define NOTE_GS3 208    fa  -3  4.
#define NOTE_A3  220
#define NOTE_AS3 233    so  -2  5.
#define NOTE_B3  247
#define NOTE_C4  262    la  -1  6.
#define NOTE_CS4 277
#define NOTE_D4  294    SI  0   7.
#define NOTE_DS4 311    do  1
#define NOTE_E4  330
#define NOTE_F4  349    re  2
#define NOTE_FS4 370
#define NOTE_G4  392    mi  3
#define NOTE_GS4 415    fa  4
#define NOTE_A4  440
#define NOTE_AS4 466    so  5
#define NOTE_B4  494
#define NOTE_C5  523    la  6
#define NOTE_CS5 554
#define NOTE_D5  587    si  7
#define NOTE_DS5 622    do  8   .1
#define NOTE_E5  659
#define NOTE_F5  698    re  9   .2
#define NOTE_FS5 740
#define NOTE_G5  784    mi  10  .3
#define NOTE_GS5 831    fa  11  .4
#define NOTE_A5  880
#define NOTE_AS5 932    so  12  .5
#define NOTE_B5  988
#define NOTE_C6  1047   la  13  .6
